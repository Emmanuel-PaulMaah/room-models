<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>3D Catalog + Scene Viewer</title>

    <!-- model-viewer -->
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <script nomodule src="https://unpkg.com/@google/model-viewer/dist/model-viewer-legacy.js"></script>

    <style>
      :root { --gap: 12px; --card-w: 180px; }
      * { box-sizing: border-box; }
      body { margin: 0; font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial; background:#0b0c0f; color:#e6e6e6; }
      header { padding: 12px 16px; border-bottom: 1px solid #1b1d22; display:flex; gap:12px; align-items:center;}
      header h1 { font-size:16px; margin:0; font-weight:600; }
      main { display:grid; grid-template-columns: 320px 1fr; min-height: calc(100vh - 50px); }
      #sidebar { border-right:1px solid #1b1d22; padding:12px; }
      #grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(var(--card-w), 1fr)); gap: var(--gap); }
      .card { background:#111317; border:1px solid #1b1d22; border-radius:10px; overflow:hidden; cursor:pointer; }
      .thumb { width:100%; height:140px; display:block; }
      .meta { padding:8px; display:flex; justify-content:space-between; align-items:center; }
      .name { font-weight:600; font-size:12px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
      .open { font-size:12px; opacity:0.8; }
      #viewerPane { padding:16px; display:flex; flex-direction:column; gap:12px; }
      #viewer { width:100%; height:min(70vh, 560px); background:#0d0f14; border:1px solid #1b1d22; border-radius:12px; }
      #viewer[reveal="interaction"]::part(default-progress-bar) { display:none; }
      .row { display:flex; gap:8px; align-items:center; }
      button { padding:8px 12px; background:#1b1f27; border:1px solid #2a2f3a; color:#e6e6e6; border-radius:8px; cursor:pointer; }
      button[disabled] { opacity:.5; cursor:not-allowed; }
      .hint { opacity:.7; font-size:12px; }
      a { color:#9dc1ff; text-decoration:none; }
      @media (max-width: 900px) { main { grid-template-columns: 1fr; } #sidebar { order:2 } #viewerPane { order:1 } }
    </style>
  </head>
  <body>
    <header>
      <h1>3D Models → Preview → AR</h1>
      <span class="hint">Select a card. Tap “View in your space” on Android.</span>
    </header>

    <main>
      <aside id="sidebar">
        <div id="grid"></div>
      </aside>

      <section id="viewerPane">
        <model-viewer id="viewer"
          ar
          ar-modes="scene-viewer"
          camera-controls
          shadow-intensity="1"
          exposure="1"
          environment-image="neutral"
          poster=""
          reveal="interaction"
          autoplay
        >
          <button slot="ar-button" id="arButton">View in your space</button>
          <div slot="poster" class="hint" style="padding:12px;">Tap to load preview</div>
          <div class="hint" slot="progress-bar">Loading…</div>
        </model-viewer>

        <div class="row">
          <div id="title" style="font-weight:600;"></div>
          <a id="srcLink" target="_blank" rel="noreferrer">source</a>
        </div>
        <div class="hint">AR uses Google Scene Viewer on Android. Desktop shows 3D only.</div>
      </section>
    </main>

    <script>
      // Minimal catalog. Edit/add entries.
      const MODELS = [
        {
          name: "Damaged Helmet",
          glb: "https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/DamagedHelmet/glTF-Binary/DamagedHelmet.glb",
          // Use the same GLB for preview; model-viewer renders it like a “2D” poster in the card.
        },
        {
          name: "Boom Box",
          glb: "https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/BoomBox/glTF-Binary/BoomBox.glb",
        },
        {
          name: "Duck",
          glb: "https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/Duck/glTF-Binary/Duck.glb",
        },
      ];

      const grid = document.getElementById('grid');
      const viewer = document.getElementById('viewer');
      const titleEl = document.getElementById('title');
      const srcLink = document.getElementById('srcLink');
      const arButton = document.getElementById('arButton');

      // Simple platform gate: Scene Viewer only on Android Chrome.
      const isAndroid = /Android/i.test(navigator.userAgent);
      const isChrome = /Chrome/i.test(navigator.userAgent);
      const sceneViewerSupported = isAndroid && isChrome;
      if (!sceneViewerSupported) {
        arButton.setAttribute('disabled', 'true');
        arButton.textContent = 'AR requires Android Chrome';
      }

      function selectModel(m) {
        viewer.src = m.glb;
        viewer.setAttribute('poster', '');
        titleEl.textContent = m.name;
        srcLink.href = m.glb;
      }

      // Build cards. Each card uses a tiny model-viewer as a “2D-like” preview.
      MODELS.forEach((m, idx) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.addEventListener('click', () => selectModel(m));

        const thumb = document.createElement('model-viewer');
        thumb.className = 'thumb';
        thumb.setAttribute('src', m.glb);
        thumb.setAttribute('reveal', 'interaction'); // shows a poster until tapped; looks like 2D
        thumb.setAttribute('interaction-prompt', 'none');
        // No camera controls to keep it “image-like”
        // Note: we still use model-viewer to avoid hunting for posters.

        const meta = document.createElement('div');
        meta.className = 'meta';

        const name = document.createElement('div');
        name.className = 'name';
        name.textContent = m.name;

        const open = document.createElement('div');
        open.className = 'open';
        open.textContent = 'open';

        meta.appendChild(name);
        meta.appendChild(open);
        card.appendChild(thumb);
        card.appendChild(meta);
        grid.appendChild(card);

        if (idx === 0) selectModel(m);
      });

      // Optional: direct AR intent if you want a custom AR button behavior.
      // model-viewer already wires the slot="ar-button" when ar + scene-viewer are set,
      // so the default click will launch Scene Viewer with the current `src`.
      // Nothing else needed here.
    </script>
  </body>
</html>
